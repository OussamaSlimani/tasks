<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Weekly Routine Overview</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <!-- Custom CSS -->
    <style>
        .day-column {
            min-height: 300px;
            border-right: 1px solid #444;
        }

        .day-column:last-child {
            border-right: none;
        }

        .day-header {
            background-color: #333;
            padding: 15px;
            text-align: center;
            font-weight: bold;
            border-bottom: 2px solid #1967d2;
            font-size: 1.1rem;
        }

        .task-item {
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            background-color: #2a2a2a;
            transition: all 0.2s;
            color: white;
            border-left: 4px solid #1967d2;
            border: 1px solid #444;
        }

        .task-item.completed {
            text-decoration: line-through;
            opacity: 0.7;
        }

        .page-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #f8f9fa;
        }

        .page-subtitle {
            color: #6c757d;
            margin-bottom: 2rem;
        }

        body {
            background-color: #1a1a1a;
            color: #f8f9fa;
            font-family: 'Poppins', sans-serif;
        }
    </style>
</head>

<body data-bs-theme="dark">
    <div class="container-fluid py-4">
        <div class="row mb-4">
            <div class="col-12 text-center">
                <h1 class="page-title">
                    <i class="fas fa-calendar-alt me-2"></i>My Weekly Routine
                </h1>
                <p class="page-subtitle">Overview of all scheduled tasks for the week</p>
            </div>
        </div>

        <div class="row" id="weekView">
            <!-- Days will be populated here by JavaScript -->
            <div class="col text-center py-5">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- jQuery for AJAX -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Firebase imports -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-database.js";

        // Firebase configuration (same as your main app)
        const firebaseConfig = {
            apiKey: "AIzaSyCsSYhTAcfBzzOpuhySNaT2hnUG8EPKMHM",
            authDomain: "task-manager-6175b.firebaseapp.com",
            databaseURL: "https://task-manager-6175b-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "task-manager-6175b",
            storageBucket: "task-manager-6175b.firebasestorage.app",
            messagingSenderId: "639877056545",
            appId: "1:639877056545:web:24275ae41e44986fb4bb60"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // Days of the week in order
        const daysOfWeek = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];

        // Function to capitalize first letter
        function capitalize(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }

        // Function to generate a unique color for each task based on its name
        function getColorForTask(taskName) {
            // Simple hash function to convert string to a number
            let hash = 0;
            for (let i = 0; i < taskName.length; i++) {
                hash = taskName.charCodeAt(i) + ((hash << 5) - hash);
            }

            // Generate HSL color values
            const hue = hash % 360;
            const saturation = 70 + (hash % 15); // 70-85%
            const lightness = 45 + (hash % 10); // 45-55%

            return `hsl(${hue}, ${saturation}%, ${lightness}%)`;
        }

        // Load tasks and render week view
        function loadTasks() {
            const tasksRef = ref(db, 'tasks');
            onValue(tasksRef, (snapshot) => {
                const tasksData = snapshot.val();
                const tasks = tasksData ? Object.values(tasksData) : [];

                // Filter only regular tasks
                const regularTasks = tasks.filter(task => task.category === 'regular');

                // Group tasks by day
                const tasksByDay = {};
                daysOfWeek.forEach(day => {
                    tasksByDay[day] = regularTasks.filter(task =>
                        task.days && task.days.includes(day));
                });

                renderWeekView(tasksByDay);
            });
        }

        // Render the week view
        function renderWeekView(tasksByDay) {
            const weekView = document.getElementById('weekView');
            weekView.innerHTML = '';

            daysOfWeek.forEach(day => {
                const dayTasks = tasksByDay[day] || [];

                const dayCol = document.createElement('div');
                dayCol.className = 'col-md day-column p-0';

                // Day header
                const dayHeader = document.createElement('div');
                dayHeader.className = 'day-header';
                dayHeader.innerHTML = `
                    ${capitalize(day)} 
                    <span class="badge bg-primary ms-1">${dayTasks.length}</span>
                `;
                dayCol.appendChild(dayHeader);

                // Tasks container
                const tasksContainer = document.createElement('div');
                tasksContainer.className = 'p-2';

                if (dayTasks.length === 0) {
                    tasksContainer.innerHTML = `
                        <div class="text-center text-muted py-3">
                            <i class="far fa-smile"></i>
                            <p class="small mt-2">No tasks scheduled</p>
                        </div>
                    `;
                } else {
                    dayTasks.forEach(task => {
                        const taskItem = document.createElement('div');
                        taskItem.className = 'task-item';

                        // Check if task is completed for this day
                        if (task.completed && task.completed[day]) {
                            taskItem.classList.add('completed');
                        }

                        taskItem.textContent = task.name;

                        // Set unique color for this task
                        const taskColor = getColorForTask(task.name);
                        taskItem.style.borderLeftColor = taskColor;

                        tasksContainer.appendChild(taskItem);
                    });
                }

                dayCol.appendChild(tasksContainer);
                weekView.appendChild(dayCol);
            });
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', loadTasks);
    </script>
</body>

</html>